#!/bin/bash
# Launch Claude Code on desktop to work on x61 files via SSHFS

# Configuration
DESKTOP_HOST="10.0.0.140"
X61_USER="aidan"
X61_HOST="10.0.0.44"
MOUNT_POINT="x61-mount"
PROJECT_DIR="${1:-.}"

# SSH to desktop, mount x61 filesystem, and run Claude Code
ssh -t "$DESKTOP_HOST" "
    # Create mount point if it doesn't exist
    mkdir -p ~/$MOUNT_POINT

    # Mount x61 filesystem if not already mounted
    ALREADY_MOUNTED=false
    if mountpoint -q ~/$MOUNT_POINT; then
        ALREADY_MOUNTED=true
    else
        echo 'Mounting x61 filesystem...'
        sshfs $X61_USER@$X61_HOST:/home/$X61_USER ~/$MOUNT_POINT
    fi

    # Set up cleanup to unmount if we mounted it
    cleanup() {
        if [ \"\$ALREADY_MOUNTED\" = false ]; then
            echo 'Unmounting x61 filesystem...'
            fusermount -u ~/$MOUNT_POINT
        fi
    }
    trap cleanup EXIT

    # Launch Claude Code on the mounted path
    cd ~/$MOUNT_POINT/$PROJECT_DIR && claude --append-system-prompt \"You are running on desktop host (10.0.0.140) with files mounted from x61 machine (10.0.0.44) via SSHFS. Commands you execute run locally on the desktop. Files you're editing are on the x61 filesystem through the SSHFS mount. To install or run software directly on the x61, you need to SSH to it.\"
"
